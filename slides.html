<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Estimating Costal Property Values in Florida</title>
    <meta charset="utf-8" />
    <meta name="author" content="Langyi Tian" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/rutgers-fonts.css" rel="stylesheet" />
    <link href="libs/remark-css/duke-blue.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Estimating Costal Property Values in Florida
### Langyi Tian

---

exclude: true




```r
library("knitr")
knitr::opts_chunk$set(
  echo = FALSE,
  eval = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 15,
  fig.height = 7,
  figure.align = "center",
  cache = TRUE,
  cache.lazy = FALSE
)
#knitr::opts_knit$set(root.dir = "C:\\Users\\Tianl\\Documents\\GitHub\\First-Street-Foundation")
options(htmltools.dir.version = FALSE)
```



---
## Executive summary
Objective
 - Organizational mission: Quantify the financial risk of tidal flooding to address stakeholder concern
 - Task for this research: Make the numbers more accurate with market value estimation

Data
 - Administrative property records (3 million), transaction records from ATTOM Data Solutions
 - Demographic data from census data
 - Flooding projections from National Oceanic and Atmospheric Administration (NOAA) 
 
Methodology
 - Build seperate models within each city and county 
 - Regularization models (Ridge, LASSO) as baseline
 - Regression trees e.g. random forest and gradient boosting as comparison for trial models

Findings
 - Trees work better than baseline
 - Random forest algorithm consistently outperformed by gradient boosting
 - City-level models have varying performance
 - Ability to predict within 10% deviation in some cities
 
---
## Project roadmap

1. Data preparation

2. Exploratory analysis

3. Seperate modeling: one model for each city/county data

4. Feature selection with individual models

5. Build seperate predictive models for 85 city-level subsamples

6. Functionalities to test and parse out performance metrics for regularized models and regression trees

7. Personalize data filtering parameters

8. Iteration through cities/counties and view corss-validated model performance, map county-level model performance

---
## 1. Data preparation
Select features from property records in a real estate broker's database. 



```r
#Select features to import, subset and save
home_dta &lt;- select(
  home_dta_original,
  attomid,#Matching ID
  deedlastsaleprice,#Transaction price last sale
  situsstatecode,#State code
  situscounty,#County code
  propertyaddresscity,#City code
  ownertypedescription1,#First owner is individual/company?
  ownertypedescription2,#Second owner is individual/company?
  deedlastsaledate,#Date of market sale
  yearbuilt,#Year when built
  propertyusegroup,#Commercial/residential?
  areabuilding,#Living area in sq.feet
  censustract,#Census tract division
  propertylatitude,#Lat of property
  propertylongitude,#Lon of property
  roomsatticflag,#See below
  parkinggarage:communityrecroomflag#A series variable measuring physical attributes of the property, including rooms count and relevant facilities
)
```



---
## 1. Data preparation
Select features from environmental risk and demographic data set constructed by Porter



```r
risk_dta &lt;-
  risk_dta_original %&gt;% select(attomid = ATTOM_ID, #ID
                               dist_coast, #Distance to coast
                               mdkt32, #Flooding probability estimate in next years
                               Totpopbg:near_reading_rates, )#a set of demographic information varying by census tract
```



Get a simple feature of transaction frequence from transaction records



```r
trans_dta &lt;-
  trans_dta_original %&gt;% group_by(attomid) %&gt;% summarize(trans_times = n())#Number of transactions
```






```
## Up to here, the data dimension is 3327923 * 203
```

---
## 1. Data preparation




 - Drop all unary features

```
## Up to here, the data dimension is 3327923 * 91
```

 - Drop variables with too many levels, besides those are numerical

```
## [1] "hvacheatingdetail"
## [1] "exterior1code"
## [1] "roofmaterial"
## [1] "roofconstruction"
```

```
## Up to here, the data dimension is 3327923 * 87
```
 

 
 - Recoded characters to factors

```
## These variables are recoded to factors
```

```
## [1] "situsstatecode"
## [1] "situscounty"
## [1] "propertyaddresscity"
## [1] "ownertypedescription1"
## [1] "ownertypedescription2"
## [1] "propertyusegroup"
## [1] "viewdescription"
## [1] "porchcode"
```



 - Hold out cities with sample size too small to go into tree model.

```
## Up to here, the data dimension is 3248508 * 87
```

---
exclude: true

## 2. Exploratory analysis
Plot summary graph of a few important variables to understand their overall statistical distribution






---
## 2. Exploratory analysis

 - Summarize a few key variables by county to see the geographical variation

 
![](slides_files/figure-html/unnamed-chunk-24-1.png)&lt;!-- --&gt;

---
## 2. Exploratory analysis

 
![](slides_files/figure-html/unnamed-chunk-26-1.png)&lt;!-- --&gt;

---
## 2. Exploratory analysis



![](slides_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;

---
## 2. Exploratory analysis

 
![](slides_files/figure-html/unnamed-chunk-30-1.png)&lt;!-- --&gt;

---
## 2. Exploratory analysis


![](slides_files/figure-html/unnamed-chunk-32-1.png)&lt;!-- --&gt;

---
## 2. Exploratory analysis
![](slides_files/figure-html/unnamed-chunk-33-1.png)&lt;!-- --&gt;

---
## 2. Exploratory analysis



 
![](slides_files/figure-html/unnamed-chunk-36-1.png)&lt;!-- --&gt;

---
## 2. Exploratory analysis
![](slides_files/figure-html/unnamed-chunk-37-1.png)&lt;!-- --&gt;



---
## 3. Seperate modeling: one model for each city/county data
 - For every city/county in South Florida, we fit an individual model to it seperately.

 - Inspired by the "submarket" notion (the housing prices between neibourhoods, cities and counties vary a lot)
 
 - Feature structure vary by county

 - There are some variables that represent housing attributes that miss in data with different cases between counties.

 - The process for county-level modeling is rather straightforward.
 


---
## 4. Feature selection with individual models
 - Build function to automatically drop variables that are not important and are missing over 10% values, as we don't wish too many obs are omitted in tree model due to missing value.


 - Apply the selection functions built just now to all subsamples


 - Divided subsamples by county

```r
summary(home_county_cleaned_dta)
```

```
##            Length Class      Mode
## Broward    79     data.frame list
## Collier    72     data.frame list
## Hendry     71     data.frame list
## Lee        79     data.frame list
## Miami-Dade 82     data.frame list
## Monroe     78     data.frame list
## Palm Beach 83     data.frame list
```
---
## 4. Feature selection with individual models
 - First 5 divided subsamples by city

```r
summary(home_city_cleaned_dta)%&gt;%head()
```

```
##                    Length Class      Mode
## ALVA               70     data.frame list
## AVE MARIA          62     data.frame list
## AVENTURA           73     data.frame list
## BAL HARBOUR        68     data.frame list
## BANYAN VILLAGE     15     data.frame list
## BAY HARBOR ISLANDS 69     data.frame list
```

---
exclude: true
## 5. Interactivity to check individual properties within sample (a playaround...)
 - Build the ability to check for key features of individual properties using Google map

 


---
## 6. Build predictive models for individual subgroups
###Final Ppreprocessing of individual model before modeling
 - Develop functionality for final preprocessing before feeding data into model

 - Here we have within each model the control of missing values and division of training/test set

 - Therefore, the wragling process was automized and run in each subsample
 


###Modeling functionalities
 - Regularization (Ridge and LASSO) as baseline, try also trees
 
 - Random forest deal with data with large variations well
 
 - Gradient boosting is good at learn specific models 
 
 - A model comparison with output from random forest and gradient boosting (also Ridge and LASSO)
 
 - The function will parse validated key performance metrics and variables of importance of the models




 


---
exclude: true
## 7. Test between 4 algorithms
Test the model in subsample of cities and counties, compare several KPI of models to see which of random forest and gradient boosting does the job better.


---
## 7 Visualize model performance


![](slides_files/figure-html/unnamed-chunk-51-1.png)&lt;!-- --&gt;

---
## 7 Visualize model performance
![](slides_files/figure-html/unnamed-chunk-52-1.png)&lt;!-- --&gt;

---
## 7 Visualize model performance
![](slides_files/figure-html/unnamed-chunk-53-1.png)&lt;!-- --&gt;

---
## 7 Visualize model performance
<div id="htmlwidget-432ea0ec5ea1299c0cb8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-432ea0ec5ea1299c0cb8">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107"],["FL_Lee_ALVA","FL_Collier_AVE MARIA","FL_Miami-Dade_AVENTURA","FL_Miami-Dade_BAL HARBOUR","FL_Hendry_BANYAN VILLAGE","FL_Miami-Dade_BAY HARBOR ISLANDS","FL_Palm Beach_BELLE GLADE","FL_Monroe_BIG PINE KEY","FL_Miami-Dade_BISCAYNE PARK","FL_Lee_BOCA GRANDE","FL_Palm Beach_BOCA RATON","FL_Lee_BOKEELIA","FL_Palm Beach_BOYNTON BEACH","FL_Lee_CAPE CORAL","FL_Lee_CAPTIVA","FL_Broward_COCONUT CREEK","FL_Miami-Dade_COCONUT GROVE","FL_Broward_COOPER CITY","FL_Miami-Dade_CORAL GABLES","FL_Broward_CORAL SPRINGS","FL_Monroe_CUDJOE KEY","FL_Miami-Dade_CUTLER BAY","FL_Broward_DANIA","FL_Broward_DAVIE","FL_Broward_DEERFIELD BEACH","FL_Palm Beach_DELRAY BEACH","FL_Miami-Dade_DORAL","FL_Lee_ESTERO","FL_Miami-Dade_FLORIDA CITY","FL_Hendry_FORT DENAUD","FL_Broward_FORT LAUDERDALE","FL_Lee_FORT MYERS","FL_Lee_FORT MYERS BEACH","FL_Palm Beach_GREENACRES","FL_Broward_HALLANDALE","FL_Broward_HALLANDALE BEACH","FL_Miami-Dade_HIALEAH","FL_Miami-Dade_HIALEAH GARDENS","FL_Palm Beach_HIGHLAND BEACH","FL_Broward_HILLSBORO BEACH","FL_Broward_HOLLYWOOD","FL_Palm Beach_HYPOLUXO","FL_Monroe_ISLAMORADA","FL_Palm Beach_JUNO BEACH","FL_Palm Beach_JUPITER","FL_Miami-Dade_KEY BISCAYNE","FL_Monroe_KEY COLONY BEACH","FL_Monroe_KEY LARGO","FL_Monroe_KEY WEST","FL_Hendry_LABELLE","FL_Palm Beach_LAKE PARK","FL_Palm Beach_LAKE WORTH","FL_Palm Beach_LANTANA","FL_Broward_LAUDERDALE BY THE SEA","FL_Broward_LAUDERDALE LAKES","FL_Broward_LAUDERHILL","FL_Broward_LIGHTHOUSE POINT","FL_Monroe_LITTLE TORCH KEY","FL_Palm Beach_LOXAHATCHEE","FL_Monroe_MARATHON","FL_Collier_MARCO ISLAND","FL_Broward_MARGATE","FL_Miami-Dade_MEDLEY","FL_Miami-Dade_MIAMI","FL_Miami-Dade_MIAMI BEACH","FL_Miami-Dade_MIAMI GARDENS","FL_Miami-Dade_MIAMI LAKES","FL_Miami-Dade_MIAMI SHORES","FL_Miami-Dade_MIAMI SPRINGS","FL_Lee_MIROMAR LAKES","FL_Miami-Dade_NORTH BAY VILLAGE","FL_Lee_NORTH FORT MYERS","FL_Broward_NORTH LAUDERDALE","FL_Miami-Dade_NORTH MIAMI BEACH","FL_Palm Beach_NORTH PALM BEACH","FL_Broward_OAKLAND PARK","FL_Palm Beach_OCEAN RIDGE","FL_Miami-Dade_OPA LOCKA","FL_Palm Beach_PAHOKEE","FL_Palm Beach_PALM BEACH","FL_Palm Beach_PALM BEACH GARDENS","FL_Palm Beach_PALM SPRINGS","FL_Miami-Dade_PALMETTO BAY","FL_Broward_PARKLAND","FL_Broward_PEMBROKE PINES","FL_Broward_PLANTATION","FL_Broward_POMPANO BEACH","FL_Lee_PUNTA GORDA","FL_Palm Beach_RIVIERA BEACH","FL_Lee_SAINT JAMES CITY","FL_Lee_SANIBEL","FL_Palm Beach_SOUTH BAY","FL_Miami-Dade_SOUTH MIAMI","FL_Broward_SOUTHWEST RANCHES","FL_Monroe_SUMMERLAND KEY","FL_Miami-Dade_SUNNY ISLES BEACH","FL_Broward_SUNRISE","FL_Miami-Dade_SURFSIDE","FL_Broward_TAMARAC","FL_Monroe_TAVERNIER","FL_Palm Beach_TEQUESTA","FL_Miami-Dade_UNINCORPORATED COUNT","FL_Palm Beach_WELLINGTON","FL_Miami-Dade_WEST MIAMI","FL_Palm Beach_WEST PALM BEACH","FL_Broward_WEST PARK","FL_Broward_WILTON MANORS"],[74.597892401553,152.508728179551,173.075149838635,295.389048991354,null,135.947496884088,26.8028188286809,166.787614900822,94.8761261261261,388.7033559239,111.532710981142,89.2857142857143,97.5489371773074,86.8977874878961,338.696020321761,78.0234070221066,270.007390019127,104.0625,185.714285714286,99.1071428571429,237.566210889382,98.8721143413028,75.1711981530878,93.3032811898791,68.2926829268293,87.5073700346292,147.81092027079,138.527799530149,37.2023809523809,38.7002956916465,106.691654549823,94.8275862068966,201.103309929789,75.4033307311996,0,108,70.657507360157,74.6860588400093,241.774675972084,165.153575427932,96.1761297798378,124.401913875598,213.935574229692,190.17474811975,136.797817460317,283.333333333333,262.896825396825,186.078811369509,222.088835534214,32.6388888888889,75.4920518613503,85.9282617264486,75.2314814814815,168.864470959697,45.4677265180862,48.661800486618,120.171673819742,172.413793103448,81.9746376811594,175.948246184287,220.188854215732,67.3913043478261,141.370338248049,86.8518518518518,252.846392049546,46.0666194188519,87.1839581517001,122.914166670264,88.1383094306823,200,188.014818467288,58.9595375722543,67.6960722800853,63.2794762541598,123.185003743008,87.6190476190476,182.971456452793,37.1138667521602,20.5006473888649,224.658270021173,140.934771443246,59.2599567099567,104.339867893997,156.457173163617,91.8382352941177,89.1659501289768,86.8055555555556,142.007411928074,82.7644454799627,109.848484848485,286.184210526316,25,109.883326549993,100.003535756403,211.640211640212,212.071324420542,69.0639269406393,204.419889502762,78.5035441780667,174.423541485033,146.451060981128,0,124.993410214168,18.7553282182438,75.812274368231,54.8159749412686,133.333333333333],[0.016044061302682,0,0.00141786510026332,0.000250878073256397,0,0.00353982300884956,0,0.0742723644505013,0.00638103919781222,0.0235294117647059,0.000905144725828743,0.0449438202247191,0.00189965650046841,0.0016542948038176,0.032561788936838,0,0.00582241630276565,0.0430912687199774,0.00537909836065574,0.000142443378756944,0.0915605095541401,0.00598086124401914,0.0248874768334657,0.0516846986089644,0.00112646191564788,0.00315411561214553,0.026142722927985,0.000306583889016632,0.00263852242744063,0,0.0177592427721288,0.010056124043649,0.0333493282149712,0,0.0024390243902439,0.00663857529018922,0.00741161677225903,0.00535441101478837,0.00569665321623546,0.00129421915444349,0.0259399472454181,0.00757217226691907,0.0646675358539765,0.00544871794871795,0.00915926819555389,0.00152417902175419,0.00975609756097561,0.0545514115655545,0.0683108363819856,0,0.00166944908180301,0.000875626673992171,0.0179349648005364,0,0.00111624940200925,0.000526998540619426,0.00837491090520314,0.131133671742809,0,0.0630838131797825,0.0192613280685703,4.34272810179355e-005,0.138749101365924,0.0043972615393208,0.0164163404666241,0.00196203881424611,0.0186111111111111,0.0187932739861523,0.0265116279069767,0,0.00989094598021811,0.0234094499497343,0.000382299531683074,0.00619450753665084,0.0115367871136265,0.0110186806771745,0.03955174686882,0.00254836094057686,0,0.00321107463964607,0.0028950122078828,0,0.00288985217294654,0,0.0103225565593967,0.00943897115214442,0.00479741604521921,0.00388161086851043,0.00131438943481254,0.0876796714579055,0.102850330551642,0,0.000491279783836895,0.232428670842032,0.119383142781175,0.00146008239036346,0.000553939897521119,0.00974453515933632,0.000131027253668763,0.0438813349814586,0.0117820324005891,0,0,0,0.000990494883957618,0.00252047889098929,0.0409756097560976],[7.63040335953268,0.139168804531982,7.1957843595276,1.03109217165162,1.53315834349759,0.412165184066806,0.853550432457862,1.25530642890769,2.95843973156707,0.372323861995215,1.02947829030759,2.92758724263625,0.738671915898372,0.619997365651472,3.99046059403336,0.218793949376205,0.430868856685183,0.342035582825351,0.51646485544648,0.358140072313919,0.39781949365319,1.10493936900964,8.15165835966711,0.413961785524402,0.752111652680888,0.860640055707147,0.351086861866091,0.290991508220148,1.42251407589691,1.03725460787546,0.621843619737611,0.860292734202814,5.02691109214085,0.394283819856543,1.2513385995921,2.18378532780038,0.499501704803459,0.36794451985957,0.262283949203001,0.240119812353826,1.77582395464111,0.620739842650008,1.28634949988271,0.327607923370871,0.345678510715322,0.908504866964119,0.329956822360652,0.836674769866333,1.35909442078599,7.68756453501419,0.494505850459652,1.02510686910634,1.56905482334298,0.361924844356913,0.493138880152207,0.754530606865381,0.502654195751292,0.500378979073066,0.46244176541906,0.635674998326733,0.608782021419962,2.76941046604916,0.454305672032739,0.860769210899742,0.999781423239693,0.345574899552475,1.58198974073878,0.744248027176486,0.35845397692861,0.322237222112841,3.82782827573312,0.539725007401854,0.637379928833525,0.74331500920062,0.627358157924635,5.16753034926869,0.434594748430904,5.04073174666781,2.17663010282081,1.57112774389328,0.235964409154846,0.409698518330299,0.585582150709409,0.535130580376571,0.409280359715602,4.74756411484063,1.43644070652237,0.161154637575852,0.823618734003068,1.31491692440765,0.526521345850221,1.59720045908074,19.6926477501026,0.633653209155077,0.395074999808975,0.3964000821776,0.45968691632189,9.04410684808955,0.477480430820225,0.518163901412129,0.284924080364706,12.2632502266168,0.340936726462494,0.46942019030938,0.819225392114659,0.804783796963777,0.377206207420428],[10.4672964918621,0.417172647871918,11.6980898259232,1.04122521856096,1.43580133177156,0.748069804780997,1.74058852655098,3.20335561157967,2.80164626693827,0.759653434474722,1.68594659436642,2.82927747532787,0.508214304827723,7.80009583501676,5.48670782243756,0.235437118303508,0.462204576978746,0.334337606685972,0.636288210782888,0.808275924099344,0.98680070260852,1.86876727156197,7.75310516793622,0.662480720908949,1.56404959082767,1.41008259915404,0.591549313490316,0.858828491877888,64.6567398528022,3.59589733414829,0.896144093288848,1.37322715246386,4.81149941364199,0.555035507540925,83.5881616500724,2.03052862264868,1.07728861296986,0.417217108323847,0.276776984720877,0.300818864413351,1.60148783669176,0.614129928752024,1.66872535705471,0.534950949021158,0.531995052527925,1.07510344916171,2.73270590206678,6.12849634254986,1.13574430056834,16.6960400257139,2.34276012135948,1.21832898529116,2.49558423377762,0.464672410409889,1.31197239868544,1.79047043249626,0.823657557423932,1.23217575368388,1.1066469482174,2.22743473344774,0.671882655170363,2.15441999908366,0.62593226513895,1.9152977748822,0.902472627980107,0.776417376636357,1.43050463815105,0.815297988900391,0.597237764152336,0.416303312120094,4.58440384536848,5.53916575871336,1.13840997132492,1.01149825046632,0.769765720838305,6.01377230816893,0.476887575127678,19.7458084223665,6.66056110325274,1.89119034611587,0.348580196312474,1.11414142919335,0.659151840239655,0.635736818477717,0.653258203274365,4.83606195095049,3.11659116268087,0.248663680101738,1.24377747076222,1.34594092422091,2.08879888320425,3.95801934898479,20.3197331023403,0.924077540479242,1.02752044574463,0.482933753101967,1.07655117529365,1.7554506761914,0.473315457683274,0.733897035663624,0.792647641953175,9.87902769707487,0.665566777793062,0.840279315420239,2.49313327791898,0.77123325677512,0.765718984928433],[12.6955980416003,0.201964830280322,1.43918917047397,3.80558932977687,1.21158639715075,0.683623423187071,2.17749412794447,5.56967615547815,0.460199257882497,4.34209768405705,0.832451531017185,1.90982494365774,0.699076620634238,1.38276258539431,0.919721502529601,0.607182639405605,1.09000200137741,0.371691441768826,2.26514725192948,0.913511759045048,0.511793886684442,4.97591087095652,1.37894031056596,2.03303503308111,2.18210497402124,1.22900973363841,0.778732587036863,0.975115060106993,2.20808408277633,1.55281429058499,1.91975273510865,3.40961178451371,1.58261562009166,1.04754365539639,1.92379255660384,0.982409983806082,2.04639581890501,9.32286893002573,0.401236979975064,0.546443202830999,0.983428857310313,2.06175407850371,0.907045385534582,0.620125325849238,0.740571396398039,17.9213746769474,0.626206657403341,2.12926020054917,1.40663145849461,12.9267076940848,0.883540225512313,1.46619580658391,0.865980375639427,0.509317585441279,1.4262695401624,3.16254367261089,0.662120171380392,1.0797098544293,0.598691903638194,5.10371066867839,1.39543751795331,1.55594920444333,1.18765561843139,2.84058330714686,2.40103113135661,2.54536322307472,1.43117034074782,1.10839145745604,0.845859791140076,1.32294380996455,4.01411857907896,1.12767673116896,2.63867154090407,1.61820343733604,1.10472892556079,0.675982342234651,1.05283490929333,3.04449108476009,3.59325130807248,1.84800659564438,0.595840962198875,1.11787027128535,1.16610498277075,0.389860192065505,0.649295272458492,1.15023204999528,2.02572827198243,0.30964530747808,1.93608210304365,0.718057836540879,1.20659906585584,1.50710531903527,1.44713049222953,0.631371606420136,0.733948109397132,4.98876937204617,1.25433015362293,3.43578859042811,1.94062225071881,10.0026560407216,0.507434908750487,5.63390329187081,1.89177162363425,0.615383974770765,2.05108740605472,1.44311783882733,0.922931053073849],[12.5575312085804,0.233941977618443,1.68363225641464,3.25932766284317,1.62160835831278,0.633495833897364,2.43643972546613,5.36008178947425,0.451739006787258,4.34963392308622,0.837423492142597,1.9021088004617,0.672071836590946,1.40896826640147,0.955290857834908,0.622737640573646,1.2294633168201,0.379204690001685,1.88564605109606,0.827145893673635,0.388624436158859,5.39307132106337,1.34136075519344,2.08283289132432,2.11962997555946,1.12098959391875,0.731568700212282,0.548405438129077,2.47657550780734,1.1562329776508,2.09405034680568,3.41674603468469,1.56227764121657,1.46840252100525,16.943656171525,1.00023346057536,2.13935636887274,9.66279373339363,0.415542858070243,0.595026450490737,0.980054593193243,2.18959752865968,0.914614284826695,0.623937698378979,0.74135078495741,16.7887290106,0.608466155627756,2.08593847268723,1.32265967528439,12.64274037549,0.790802561260165,1.49938003783396,0.871038761072338,0.487107629642326,1.31098917975886,3.77711405203253,0.630972497311828,0.498327179342967,0.588778853636931,4.83267633545805,1.37172452630475,1.03504631305967,1.22567385679261,2.89220398763018,2.20640788764403,2.59053835965157,1.42748559427991,1.11382762816688,0.747562718311111,1.34211225274686,3.94404638706478,1.13457391563789,2.24526939069068,1.6900250964778,1.08590775656137,0.640677871774121,0.915440826409151,3.45794145678556,3.8162259092651,3.04134516476765,0.585261439711412,1.26802008578706,1.62416373260859,0.398425834376095,0.643636548203724,1.11944753505288,2.08516660714474,0.321650954166787,1.96299751221737,0.719960589072626,1.22473093363222,1.4690583741646,1.98331175411862,0.623728854403855,0.713654050665992,4.14018364487751,1.09955828782559,3.52799487632097,1.95583953833439,9.68044031655725,0.511463402002087,5.94103293574786,1.82401455953623,0.625745233570474,2.05952772464762,1.33646864468512,0.949929376700952]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>subsample<\/th>\n      <th>averageprice<\/th>\n      <th>floodrisk<\/th>\n      <th>rf_MAPE<\/th>\n      <th>gb_MAPE<\/th>\n      <th>ridge_MAPE<\/th>\n      <th>LASSO_MAPE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
## 7.5 Visualize model performance
![](slides_files/figure-html/unnamed-chunk-55-1.png)&lt;!-- --&gt;


---
## 8. Personalize filtering parameters for random forest
 - Filtering rule decides whether to include properties with extremely low/high price
 - Cruicial to model performance
 - Build functionalities to show model performance depending on filtering parameters

---
## 8. Personalize filtering parameters for random forest

 
![](slides_files/figure-html/unnamed-chunk-58-1.png)&lt;!-- --&gt;

---
## 8. Personalize filtering parameters for random forest 

 
![](slides_files/figure-html/unnamed-chunk-60-1.png)&lt;!-- --&gt;

---
## 8. Personalize filtering parameters for random forest 

 
![](slides_files/figure-html/unnamed-chunk-62-1.png)&lt;!-- --&gt;

---
## 8. Personalize filtering parameters for random forest 

 
![](slides_files/figure-html/unnamed-chunk-64-1.png)&lt;!-- --&gt;

---
## 9. Iteration through cities/counties and view corss-validated model performance
 - Cities


<div id="htmlwidget-a9e92ec70d6a783f491a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a9e92ec70d6a783f491a">{"x":{"filter":"none","data":[["..1","..116","..29","..96","..2","..41","..75","..28","..22","..73","..44","..8","..112","..63","..78","..110","..38","..42","..51","..89","..103","..113","..62","..93","..53","..43","..58","..60","..115","..64","..99","..5","..104","..90","..17","..55","..106","..100","..91","..19","..48","..108","..66","..85","..67","..83","..15","..71","..117","..14","..39","..47","..80","..56","..82","..50","..20","..32","..27","..68","..94","..18","..25","..79","..95","..76","..36","..72","..101","..34","..81","..98","..65","..4","..23","..52","..114","..12","..33","..57","..11","..21","..70","..3","..49","..77","..88","..45","..13","..105","..6","..10","..31","..59","..84","..97","..26","..46","..24","..87","..7","..9","..16","..107","..111","..69","..40","..102","..61","..109","..35",".","..92","..37","..86","..54","..74","..30"],["FL_Collier_AVE MARIA","FL_Broward_WESTON","FL_Lee_ESTERO","FL_Lee_PUNTA GORDA","FL_Miami-Dade_AVENTURA","FL_Palm Beach_HIGHLAND BEACH","FL_Broward_MIRAMAR","FL_Miami-Dade_DORAL","FL_Monroe_CUDJOE KEY","FL_Miami-Dade_MIAMI SHORES","FL_Miami-Dade_HOMESTEAD","FL_Miami-Dade_BISCAYNE PARK","FL_Palm Beach_WELLINGTON","FL_Monroe_LITTLE TORCH KEY","FL_Miami-Dade_NORTH BAY VILLAGE","FL_Palm Beach_TEQUESTA","FL_Broward_HALLANDALE BEACH","FL_Broward_HILLSBORO BEACH","FL_Monroe_KEY COLONY BEACH","FL_Palm Beach_PALM BEACH GARDENS","FL_Broward_SOUTHWEST RANCHES","FL_Miami-Dade_WEST MIAMI","FL_Broward_LIGHTHOUSE POINT","FL_Broward_PEMBROKE PINES","FL_Monroe_KEY WEST","FL_Broward_HOLLYWOOD","FL_Broward_LAUDERDALE BY THE SEA","FL_Broward_LAUDERHILL","FL_Broward_WEST PARK","FL_Palm Beach_LOXAHATCHEE","FL_Lee_SAINT JAMES CITY","FL_Miami-Dade_BAY HARBOR ISLANDS","FL_Monroe_SUMMERLAND KEY","FL_Palm Beach_PALM SPRINGS","FL_Broward_COCONUT CREEK","FL_Palm Beach_LAKE PARK","FL_Broward_SUNRISE","FL_Lee_SANIBEL","FL_Miami-Dade_PALMETTO BAY","FL_Broward_COOPER CITY","FL_Palm Beach_JUNO BEACH","FL_Broward_TAMARAC","FL_Collier_MARCO ISLAND","FL_Palm Beach_OCEAN RIDGE","FL_Broward_MARGATE","FL_Palm Beach_NORTH PALM BEACH","FL_Lee_CAPTIVA","FL_Miami-Dade_MIAMI GARDENS","FL_Broward_WILTON MANORS","FL_Lee_CAPE CORAL","FL_Miami-Dade_HIALEAH","FL_Monroe_ISLAMORADA","FL_Broward_NORTH LAUDERDALE","FL_Palm Beach_LAKE WORTH","FL_Miami-Dade_NORTH MIAMI BEACH","FL_Miami-Dade_KEY BISCAYNE","FL_Miami-Dade_CORAL GABLES","FL_Hendry_FORT DENAUD","FL_Palm Beach_DELRAY BEACH","FL_Miami-Dade_MEDLEY","FL_Broward_PLANTATION","FL_Miami-Dade_COCONUT GROVE","FL_Broward_DAVIE","FL_Lee_NORTH FORT MYERS","FL_Broward_POMPANO BEACH","FL_Lee_MIROMAR LAKES","FL_Palm Beach_GREENACRES","FL_Miami-Dade_MIAMI LAKES","FL_Palm Beach_SOUTH BAY","FL_Lee_FORT MYERS","FL_Miami-Dade_NORTH MIAMI","FL_Palm Beach_ROYAL PALM BEACH","FL_Monroe_MARATHON","FL_Hendry_BANYAN VILLAGE","FL_Miami-Dade_CUTLER BAY","FL_Monroe_KEY LARGO","FL_Palm Beach_WEST PALM BEACH","FL_Lee_Collier_BONITA SPRINGS","FL_Broward_FORT LAUDERDALE","FL_Palm Beach_LANTANA","FL_Lee_BOKEELIA","FL_Broward_CORAL SPRINGS","FL_Miami-Dade_MIAMI BEACH","FL_Miami-Dade_BAL HARBOUR","FL_Palm Beach_JUPITER","FL_Collier_Lee_NAPLES","FL_Palm Beach_PALM BEACH","FL_Palm Beach_HYPOLUXO","FL_Palm Beach_BOYNTON BEACH","FL_Miami-Dade_SUNNY ISLES BEACH","FL_Palm Beach_BELLE GLADE","FL_Palm Beach_BOCA RATON","FL_Miami-Dade_FLORIDA CITY","FL_Broward_LAUDERDALE LAKES","FL_Broward_OAKLAND PARK","FL_Palm Beach_RIVIERA BEACH","FL_Broward_DEERFIELD BEACH","FL_Collier_Hendry_IMMOKALEE","FL_Broward_DANIA","FL_Palm Beach_PAHOKEE","FL_Monroe_BIG PINE KEY","FL_Lee_BOCA GRANDE","FL_Hendry_Palm Beach_CLEWISTON","FL_Miami-Dade_SURFSIDE","FL_Miami-Dade_UNINCORPORATED COUNT","FL_Miami-Dade_MIAMI","FL_Miami-Dade_HIALEAH GARDENS","FL_Miami-Dade_SOUTH MIAMI","FL_Lee_LEHIGH ACRES","FL_Monroe_TAVERNIER","FL_Lee_FORT MYERS BEACH","FL_Lee_ALVA","FL_Broward_PARKLAND","FL_Broward_HALLANDALE","FL_Miami-Dade_OPA LOCKA","FL_Hendry_LABELLE","FL_Miami-Dade_MIAMI SPRINGS","FL_Monroe_Collier_EVERGLADES CITY"],[0.0203982135201874,0.0779097395957405,0.00859072147337172,0.18024607522673,0.0357523896652135,0.112843021869129,0.215140738594086,0.268453801984061,0.2405433987479,0.157682053252427,0.323757540609222,0.284006741190888,0.220224755258992,0.84002253007505,0.850522745839152,0.373362051227779,0.431525809184432,0.439391087682083,0.417398317844311,0.518340151330901,0.43871700422518,0.194276726443273,0.317653793240226,0.342702434501638,0.439314106473684,0.370868110940926,0.438229260771429,0.572229573930096,0.504470063190298,0.427206921484351,0.454558596125438,0.584777176331038,0.510809417679218,0.405474342960098,0.465607267620722,0.611145435678682,0.688003411883283,0.552450115526155,0.63994593864537,0.781196944118152,0.467034193729778,0.470768829087544,0.871227703121451,0.870257468579387,0.74192180488477,0.585497356517376,0.69203571092663,0.917461504585667,0.770371021198015,0.851841019708385,0.691498766869588,0.687288446311003,0.758758746460136,0.868389160004138,0.71405201094366,1.05196964606919,0.791802864391639,1.3220566268366,1.26649145385785,0.997895697000935,0.608359448931252,0.843143585752135,1.00359403309628,1.2364582896566,0.955837523241858,1.13627828955233,1.3872462362026,1.2246709404623,1.35525441207181,0.949131751300741,1.23553385394322,1.3648987239121,1.33285781062083,1.21158639715075,1.4607738753002,1.41398663075693,1.36824553529693,1.60712368522506,1.72125924394221,0.96769521691523,1.76527731166668,1.50348188342647,1.85487328926488,2.02073164458775,1.96395079271625,1.73725976452727,1.8680794430552,1.92422748030889,2.35208267417467,1.91685382926684,1.99694586853922,2.17326686869188,1.79256320383392,2.34677030643911,1.57502205335499,2.27774609049734,3.30965736001241,1.99587145544183,3.01616179462316,3.07357476000737,4.11559821968367,4.0999668765011,2.60275036187719,5.16602926460456,5.27834534233709,8.53310437578247,9.16207985918051,8.02458242125138,10.4727367546437,13.1607569366511,12.4629518980451,13.243585570503,13.4644298077024,1.33513793168042,31.259263517363,14.3380217439288,20.8985952058049,10.831656802169],[0.125724668576108,0.208957135411077,0.285669873444425,0.30964530747808,0.338652338424877,0.302315305872082,0.39560114481853,0.403168902457754,0.511793886684442,0.424086099119521,0.449928529057714,0.460199257882497,0.47552163994341,1.0797098544293,0.970018901312206,0.507434908750487,0.675857748135858,0.546443202830999,0.626206657403341,0.677329119992036,0.631371606420136,0.615383974770765,0.672622641554968,0.519106655173846,0.653435483367415,0.646220696733081,0.660474830173229,0.759786974391518,0.694656914789515,0.598566792295592,0.685794732784929,0.747883573907001,0.733948109397132,0.659737593946755,0.722081669211945,0.883540225512313,0.840739383674684,0.734822718366996,0.836238908581485,0.881823401133003,0.679891013928331,0.630419975353332,1.04403817506201,1.05283490929333,0.914302695955633,0.924575011163768,0.919721502529601,1.08546832347505,0.956350885551424,0.980615500330751,0.855050025320875,0.895665311836522,1.00298297683421,1.07466771270581,1.06740358669042,1.33827177951321,1.08924010421106,1.55281429058499,1.45573051981874,1.18765561843139,0.754344234661048,1.09000200137741,1.2091854781368,1.43918040430462,1.3135636347082,1.32294380996455,1.59704796508995,1.41781445626002,1.50710531903527,1.13931863842242,1.51673151354182,1.56946929672013,1.62068395668351,1.21158639715075,1.60710438646002,1.67757170688022,1.7368617313749,1.78526766494318,2.03158675995938,1.45586948234772,2.01708667469389,1.67031622786201,2.07288356057851,2.32488328632411,2.10082244477347,2.02890497528277,2.16620751639174,2.06175407850371,2.49128776827783,2.48843940561663,2.17749412794447,2.34886428726659,2.20808408277633,2.45598298296143,1.71487089239296,2.51590752276502,3.50157790603607,2.19322842063049,3.20672003864371,3.59325130807248,4.36491650639843,4.34209768405705,4.36013742202111,5.38692409220517,5.63390329187081,8.72796886787432,9.32286893002573,8.26723550874244,10.7307590461767,13.3432275573259,12.687732178506,13.5777860003584,13.6311899394299,1.92379255660384,32.1313839532864,18.5111804517133,21.0530863028229,10.9471533329206],[0.0200407281535674,0.102455538102122,0.1243865835056,0.187859309819586,0.0226081928721927,0.181675875905562,0.166575928827484,0.256254453166559,0.183243734126733,0.147231099159446,0.31768348845071,0.25943478246072,0.221663395873918,0.146926720942898,0.271466997877625,0.371748449892278,0.397330569899631,0.489232537922211,0.420875810562081,0.496246208501722,0.43780159625444,0.222654707833423,0.310156594297887,0.483597629032898,0.429797622639581,0.321134870919079,0.458309144785158,0.415076635516404,0.516043475946857,0.475967458511687,0.46847070874686,0.520189421857418,0.495884731181906,0.374525345609632,0.353736722229335,0.37483837481238,0.642417237109326,0.630609443453885,0.63946832750924,0.760042748400237,0.641559032437201,0.678197201974756,0.716698494458691,0.708886456167146,0.76826547696833,0.586013925936383,0.748972762248761,0.7952763977139,0.829131180469071,0.774217159070665,0.825284484058671,0.811366439291683,0.822043838256063,0.827682969599895,0.78849674534154,0.861426598331154,0.798573754236963,0.869287720365813,0.857437418455158,1.07149859993096,1.02475918666099,0.952361310349938,1.02642775286832,0.927405119312776,0.968811057570616,1.1452380689862,1.23102414494851,1.23333039466695,1.28556189612584,1.2494271963491,1.30430605611536,1.44137120182572,1.2848761122089,1.5852338705588,1.4700722712547,1.53734755741136,1.27657118548032,1.66762810846584,1.62766265085952,1.48954261391509,1.72970879746374,1.73313639132777,1.86680429527825,1.83043547748486,2.02049181292726,1.83865361363825,1.93466295639537,2.04241766411615,2.13296412647728,1.7157836288951,2.22152856100132,2.23552773450092,1.86321879331876,2.39445778920504,2.39495277696447,2.30850986701533,2.63624772885619,2.88630024417819,2.92505249923558,3.15784937493431,4.07987848438145,4.11965864072844,2.64708085429997,5.36764194585283,5.60664705548443,7.27614182433248,9.48361120835125,9.9551449728324,10.7098519721051,12.9700914696442,13.3893447088336,13.3063484089677,14.3086140015469,16.482256852174,18.6609860503993,13.6758907349863,20.8770713654801,34.2508949495669],[0.125052870246826,0.23376581593698,0.314679906498095,0.321650954166787,0.334537976992937,0.339469768512116,0.379833493511705,0.385327108203687,0.388624436158859,0.402561214272047,0.447903217385603,0.451739006787258,0.472859154331163,0.498327179342967,0.505007184417429,0.511463402002087,0.582736815911913,0.595026450490737,0.608466155627756,0.621591685198888,0.623728854403855,0.625745233570474,0.627663347302101,0.642455962420287,0.642938555643909,0.649712299315363,0.656160284332781,0.656453198467284,0.680389299282128,0.681364379199739,0.69074038196696,0.700341225586023,0.713654050665992,0.727080700623844,0.773523987300128,0.790802561260165,0.814389170435063,0.825667287133962,0.860430026231361,0.862376088334233,0.864413300222433,0.883388519720673,0.898873973831377,0.915440826409151,0.92281847572309,0.940063133907626,0.955290857834908,0.989504192948143,1.0065086434226,1.01282097776503,1.0307837831941,1.04293315134196,1.04302409178968,1.06295298549748,1.0828660283224,1.11721937511292,1.12892747484848,1.1562329776508,1.17076646958675,1.22567385679261,1.2280204332754,1.2294633168201,1.2315159980847,1.28242463001694,1.33949531606727,1.34211225274686,1.37686487861561,1.4476199206086,1.4690583741646,1.47553947965962,1.53038886380711,1.58923428054074,1.61412835209095,1.62160835831278,1.63297296135542,1.75884433642534,1.79842431459789,1.85837279187327,1.92590259817234,1.99759180291227,2.00204224706219,2.04904963868865,2.0890510897339,2.10251897355572,2.1646129026628,2.16697994891418,2.16946185461281,2.18959752865968,2.28218418210052,2.34403498922169,2.43643972546613,2.44082278513913,2.47657550780734,2.59960205880901,2.61579343379677,2.66271830527003,2.83597513710335,3.09146021400935,3.12469033961151,3.8162259092651,4.34651194942048,4.34963392308622,4.36506512663991,5.55816164041968,5.94103293574786,7.4889417013778,9.66279373339363,10.2311915995861,10.9732425945685,13.126268161214,13.6023559242932,13.643604995261,14.4736851460991,16.943656171525,18.7766457894061,20.2469471269704,21.0198434697217,34.3793864387174]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>subsample<\/th>\n      <th>ridge_MPE<\/th>\n      <th>ridge_MAPE<\/th>\n      <th>LASSO_MPE<\/th>\n      <th>LASSO_MAPE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>


---
## 9. Iteration through cities/counties and view corss-validated model performance
 - Counties


<div id="htmlwidget-fc3b6f736d2909201aed" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fc3b6f736d2909201aed">{"x":{"filter":"none","data":[["..1","..3",".","..5","..6","..4","..2"],["FL Collier","FL Lee","FL Broward","FL Monroe","FL Palm Beach","FL Miami-Dade","FL Hendry"],[0.505128671588741,0.658740045381184,0.709788388480453,2.06095987019894,2.33663845125845,5.6224456642077,6.82166525108225],[0.799125392180328,0.833696739321913,0.899616779825107,2.26445715482043,2.48427375850428,6.00813090214987,7.2131084650709],[0.45493533077685,0.59375836857304,0.689732506569334,1.90690092818672,3.57512033409527,4.92200213878811,5.71983329622686],[0.7900587809033,0.80599816818285,0.902460244992195,2.12316217932807,3.76874391506075,5.26792274384075,6.19049287168794]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>subsample<\/th>\n      <th>ridge_MPE<\/th>\n      <th>ridge_MAPE<\/th>\n      <th>LASSO_MPE<\/th>\n      <th>LASSO_MAPE<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
## 10. Map county-level model performance
We can to see how each county performs on the map.


![](slides_files/figure-html/unnamed-chunk-70-1.png)&lt;!-- --&gt;

---
exclude: true
## 10. Map county-level model performance
If we recall previous exploratory analysis, the county's performance relies quite some on the features of each individual county. For some counties which lack a considerable number of important attributes, the prediction power is small. This sugggests it's correct to model by county to avoid the data quality issue of some counties will spread to the whole sample, but how to improve the low data quality prediction can be a subsequent challenge.

---
## 11. Brief Summary

 - Random forest algorithm consistently outperformed by gradient boosting

 - City-level models have varying performance and have potential for better model selection

 - Ability to predict within 10% deviation in some cities

 - Key filtering parameters optimized to improve prediction with reasonable constraint on sample size

 - Transaction time and building area is 2 primary factor to determine property value
 
## 12. Next step

 - Add census tract block medium price as control

 - Can try tuning the filtering parameter for each model

 - log scale price

 - recode zip code to dummy (one-hot recoding)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
